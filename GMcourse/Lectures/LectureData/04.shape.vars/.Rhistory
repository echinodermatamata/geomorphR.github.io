library(geomorph)
lizards <- readland.nts('lizards_LAT.nts')
lizards
dim(lizards)
links <- read.csv('links.txt')
links
Y.gpa <- gpagen(lizards)
plotAllSpecimens(Y.gpa$coords)
plotAllSpecimens(lizards)
plotAllSpecimens(lizards, links=links)
plotAllSpecimens(lizards, links = links)
links <- read.csv('links.txt', header=FALSE)
di(links)
dim(links)
links
links <- read.csv('links.txt', header=FALSE, sep = " ")
dim(links)
plotAllSpecimens(lizards, links = links)
plotAllSpecimens(Y.gpa$coords, links=links)
#############
# shape spaces:
n=2000
p=3
k=2
tri<- arrayspecs(matrix(rnorn(n*p*k),nrows=n),p=p,k=k)
library(geomorph)
tri<- arrayspecs(matrix(rnorn(n*p*k),nrows=n),p=p,k=k)
tri<- arrayspecs(matrix(rnorn(n*p*k),nrow=n),p=p,k=k)
tri<- arrayspecs(matrix(rnorm(n*p*k),nrow=n),p=p,k=k)
dim(tri)
tri.gpa <- gpagen(tri,Proj = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot(pc.tri[,1:2])
plot(pc.tri[,1:2], asp=1, pch=21, bg="red")
library(scatterplot3d)
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3])
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1)
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21, bg="red")
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],-pc.tri[,3], asp=1, pch=21, bg="red")
#############
# shape spaces:
n=5000
p=3
k=2
tri<- arrayspecs(matrix(rnorm(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot(pc.tri[,1:2], asp=1, pch=21, bg="red")
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],-pc.tri[,3], asp=1, pch=21, bg="red")
#############
# shape spaces:
n=1000
p=3
k=2
tri<- arrayspecs(matrix(rnorm(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot(pc.tri[,1:2], asp=1, pch=21, bg="red")
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],-pc.tri[,3], asp=1, pch=21, bg="red")
#############
# shape spaces:
n=2000
p=3
k=2
tri<- arrayspecs(matrix(rnorm(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot(pc.tri[,1:2], asp=1, pch=21, bg="red")
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],-pc.tri[,3], asp=1, pch=21, bg="red")
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21, bg="red")
#############
# shape spaces:
n=2000
p=3
k=2
seed = 2
tri<- arrayspecs(matrix(rnorm(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21, bg="red")
seed = 4
tri<- arrayspecs(matrix(rnorm(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21, bg="red")
plot(pc.tri[,1:2], asp=1, pch=21, bg="red")
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21, cex=.6,bg="red")
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red")
?scatterplot3d
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE)
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, axis=FALSE)
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, xlab=FALSE)
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, xlab=NULL)
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE, xlab=NULL)
plot(pc.tri[,1:2], asp=1, pch=21, bg="red")
plot(pc.tri[,1],pc.tri[,2], asp=1, pch=21, bg="red")
plot(pc.tri[,1:2], asp=1, pch=21, bg="red")
liz.lab <- read.csv('liz_groups.csv',header=TRUE)
liz.lab
liz.lab <- read.csv('liz_groups.csv',header=TRUE, sep="\t")
lib.lab
liz.lab
liz.lab$SEX
?plotAllSpecimens
plotAllSpecimens(lizards, links = links, plot.param = list(c(pt.bg=liz.lab)))
lizards <- readland.nts('lizards_LAT.nts')
links <- read.csv('links.txt', header=FALSE, sep = " ")
liz.lab <- read.csv('liz_groups.csv',header=TRUE, sep="\t")
Y.gpa <- gpagen(lizards, print.progress = FALSE)
plotAllSpecimens(lizards, links = links, plot.param = list(c(pt.bg=liz.lab)))
plotAllSpecimens(Y.gpa$coords, links=links)
plotAllSpecimens(lizards, links = links)
plotAllSpecimens(Y.gpa$coords, links=links)
setwd("C:/DeanData/Teaching/Workshops/2019-Chile/2019-Chile/Lectures")
n=2000
p=3
k=2
seed = 2
tri<- arrayspecs(matrix(runif(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE, print.progress = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
plot(pc.tri[,1:2], asp=1, pch=21, bg="red")
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
pc.tri[,3]
range(pc.tri[,3])
tri<- arrayspecs(matrix(runif(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE, print.progress = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
range(pc.tri[,3])
tri<- arrayspecs(matrix(runif(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE, print.progress = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
range(pc.tri[,3])
tri<- arrayspecs(matrix(runif(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE, print.progress = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
range(pc.tri[,3])
tri<- arrayspecs(matrix(runif(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE, print.progress = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
range(pc.tri[,3])
tri<- arrayspecs(matrix(runif(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE, print.progress = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
range(pc.tri[,3])
which.min(abs(range(pc.tri[,3])))
mult.pc <- ifelse(which.min(abs(range(pc.tri[,3])))=1{-1,1}
mult.pc <- ifelse(which.min(abs(range(pc.tri[,3])))==1{-1,1}
mult.pc <- ifelse(which.min(abs(range(pc.tri[,3])))==1){-1,1}
mult.pc <- ifelse(which.min(abs(range(pc.tri[,3])))==1-1,1)
mult.pc <- ifelse(which.min(abs(range(pc.tri[,3])))==1,-1,1)
mult.pc
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],mult.pc*pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
seed = 2
tri<- arrayspecs(matrix(runif(n*p*k),nrow=n),p=p,k=k)
tri.gpa <- gpagen(tri,Proj = FALSE, print.progress = FALSE)
pc.tri <- prcomp(two.d.array(tri.gpa$coords))$x
mult.pc <- ifelse(which.min(abs(range(pc.tri[,3])))==1,-1,1)
mult.pc
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],mult.pc*pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
plot<-scatterplot3d(pc.tri[,1],pc.tri[,2],pc.tri[,3], asp=1, pch=21,bg="red",
tick.marks = FALSE, box=FALSE)
geomorph:::phylo.mat
e <= matrix(c(.721, -.721,.721,-.721,-.721, .721,-.721,.721,.721, -.721,.721,-.721,-.721, .721,-.721,.721)),byrow=T,ncol=4)
e <- matrix(c(.721, -.721,.721,-.721,-.721, .721,-.721,.721,.721, -.721,.721,-.721,-.721, .721,-.721,.721)),byrow=T,ncol=4)
c(.721, -.721,.721,-.721,-.721, .721,-.721,.721,.721, -.721,.721,-.721,-.721, .721,-.721,.721)
matrix(c(.721, -.721,.721,-.721,-.721, .721,-.721,.721,.721, -.721,.721,-.721,-.721, .721,-.721,.721),ncol=4)
matrix(c(.721, -.721,.721,-.721,-.721, .721,-.721,.721,.721, -.721,.721,-.721,-.721, .721,-.721,.721),ncol=4)->E
E
eigen(E)$vectors
eigen(E)$values
plotAllSpecimens(tri.gpa$coords)
tri.gpa2 <- gpagen(tri, print.progress = FALSE)
plotAllSpecimens(tri.gpa2$coords)
dist.shape <- dist(two.d.array(tri.gpa$coords))
dist.Kendall <- dist(two.d.array(tri.gpa2$coords))
cor(dist.shape,dist.Kendall)
plot(dist.shape,dist.Kendall)
setwd("C:/DeanData/Teaching/Workshops/2019-Chile/2019-Chile/Lectures/LectureData/04.shape.vars")
library(geomorph)
library(scatterplot3d)
lizards <- readland.nts('lizards_LAT.nts')
links <- read.csv('links.txt', header=FALSE, sep = " ")
liz.lab <- read.csv('liz_groups.csv',header=TRUE, sep="\t")
col.gp <- rep("red",nrow(liz.lab))
col.gp[which(liz.lab$SEX=='M')] <- 'blue'
Y.gpa <- gpagen(lizards, print.progress = FALSE)
####  RWA with alpha -1 & 1
ref <- mshape(Y.gpa$coords)
plotRefToTarget
LInv <- geomorph:::Ltemplate(ref)
dim(LInv)
L.inv <- geomorph:::Ltemplate(ref)
BE <- eigen(L.inv)
BE$values
geomorph:::Ltemplate
sort(BE$values)
rank(BE$values)
BE$values
geomorph:::tps
geomorph:::tps2d
BE <- svd(L.inv)
BE
BE$d
BE <- eigen(L.inv)
BE2 <- svd(L.inv)
BE$values
BE2$d
BE <- svd(L.inv)
dim(L.inv)
p.3 <- dim(L.inv)[1]
PW <- BE$u[,(p.3-3)]
dim(PW)
PW
BE$u
BE$u[,(1:9)]
p.3 <- dim(L.inv)[1]
PW <- BE$u[,(p.3-3)]
PW
$\small\mathbf{W}=\mathbf{V(I_2\otimes{E\Lambda^{-\alpha/2}})}$
#############
# shape spaces:
n=2000
p.3 <- dim(L.inv)[1]
p.3
p.3-3
BE$u[,(p.3-3)]
BE$u
BE$u[,1:9]
PW <- BE$u[,1:9]
PW
lam <- BE$d[1:9]
lam
dim(Y.gpa$coords)
diag(lam)
diag(lam)^0
diag(lam)^(-.5)
p<-nrow(ref)
p
x
x <- cov(matrix(rnorm(1000),ncol=10))
x
eigen(x)
eigen(x)$vectors
eigen(x)$vectors[,1]
svd(x)$u[,1]
BE$u[,1:(p-3)]
BE$d[1:(p-1)]
BE$d[1:(p-1)]^0
BE$d[1:(p-1)]^-(1/2)
diag(BE$d[1:(p-1)]^-(1/2))
PW.1 <-crossprod(BE$u[,1:(p-3)],diag(BE$d[1:(p-1)]^-(1/2)))
PW.1 <-BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-1)]^-(1/2))
BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-1)]^-(1/2))
dim(BE$u[,1:(p-3)])
crossprod(BE$u[,1:(p-3)],diag(BE$d[1:(p-3)]^-(1/2)))
diag(BE$d[1:(p-3)]^-(1/2))
BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(1/2))
PW.m1 <- BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(-1/2))
PW.1
PW.1 <- BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(1/2))
PW.1
PW.m1
kronecker(diag(2),PW.1)
PW.1 <- kronecker(diag(2),BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(1/2)))
PW.m1 <- kronecker(diag(2),BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(-1/2)))
kronecker(diag(2),PW.1)
ref
vector(ref)
as.vector(ref)
as.vector(ref)%*%PW.1
as.vector(Y.gpa$coords[,,1])%*%PW.1
PrW.1 <- kronecker(diag(2),BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(1/2)))
PrW.m1 <- kronecker(diag(2),BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(-1/2)))
dim(Y.gpa$coords)[3]
PW.1 <- simplify2array(lapply(1:dim(Y.gpa$coords)[3], function(j) as.vector(Y.gpa$coords[,,j])%*%PW.1))
dim(PW.1)
PW.1 <- lapply(1:dim(Y.gpa$coords)[3], function(j) as.vector(Y.gpa$coords[,,j])%*%PW.1)
lapply(1:dim(Y.gpa$coords)[3], function(j) as.vector(Y.gpa$coords[,,j])%*%PW.1)
j=1
as.vector(Y.gpa$coords[,,j])
as.vector(Y.gpa$coords[,,j])%*%PW.1
dim(PW.1)
PrW.1 <- kronecker(diag(2),BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(1/2)))
PrW.m1 <- kronecker(diag(2),BE$u[,1:(p-3)]%*%diag(BE$d[1:(p-3)]^-(-1/2)))
as.vector(Y.gpa$coords[,,j])%*%PrW.1
PW.1 <- lapply(1:dim(Y.gpa$coords)[3], function(j) as.vector(Y.gpa$coords[,,j])%*%PrW.1)
dim(PW.1)
PW.1
PW.1 <- unlist(lapply(1:dim(Y.gpa$coords)[3], function(j) as.vector(Y.gpa$coords[,,j])%*%PrW.1))
dim(PW.1)
PW.1 <- simplify2array(lapply(1:dim(Y.gpa$coords)[3], function(j) as.vector(Y.gpa$coords[,,j])%*%PrW.1))
dim(PW.1)
PW.1 <- two.d.array(simplify2array(lapply(1:dim(Y.gpa$coords)[3],
function(j) as.vector(Y.gpa$coords[,,j])%*%PrW.1)))
dim(PW.1)
PW.m1 <- two.d.array(simplify2array(lapply(1:dim(Y.gpa$coords)[3],
function(j) as.vector(Y.gpa$coords[,,j])%*%PrW.m1)))
plot(prcomp(PW.1)$x,asp=1, pch=21, bg=col.gp)
plot(prcomp(PW.m1)$x,asp=1, pch=21, bg=col.gp)
library(knitr)
library(geomorph)
library(scatterplot3d)
knitr::opts_chunk$set(echo = TRUE)
plot(prcomp(PW.1)$x,asp=1, pch=21, bg=col.gp, cex=1)
res<-plotTangentSpace(Y.gpa$coords,warpgrids = FALSE, groups=col.gp)
res<-plotTangentSpace(Y.gpa$coords,warpgrids = FALSE, groups=col.gp, main = "alpha = 0")
prcomp(two.d.array(Y.gpa$coords)$x,asp=1)
plot(prcomp(two.d.array(Y.gpa$coords))$x,asp=1)
