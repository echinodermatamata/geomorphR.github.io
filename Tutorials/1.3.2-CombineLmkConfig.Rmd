---
title: "**Combine Landmark Configurations**"
author: "Mark A. Conaway"
---
<br></br>

```{r, echo=F}
knitr::read_chunk("scripts/CombineLmkConfig.R")
knitr::opts_chunk$set(dev.args=list(bg = 'transparent'), fig.align = 'center', class.source = ".custom-inline", class.output = ".custom-inline")
```

```{r, prelims,eval=T,echo=F,results='hide',warning=FALSE,message=FALSE}

```
The `combine.subsets` function is best used to combine different sets of landmark data collected from the same individuals. This may be useful or necessary in the case that the researcher has reason to believe that two morphological structures, which are not spatially related, may nonetheless by phenotypically related (integrated). 
<br></br>

The inputs to this function can be either raw landmark coordinates or aligned objects of class gpagen. If the former, the function can perform a GPA on the input raw coordinates if desired.The function will also  attempt to scale configurations to their relative centroid sizes. One should be aware that scaling to relative centroid size creates *a new configuration*. The centroids of the combined configuration will be different than either subset separately. See Collyer et al. (2020) for a more detailed discussion of the effects of combining landmark configurations. 
<br></br>

<div class = "note">
#### **Warning!** 
**Do not use this function lightly or haphazardly!** Particularly if the input subsets differ in landmark density, scaling centroid sizes can have the effect of exaggerating the centroid sizes of smaller configurations. In this case it is likely best to normalize centroid sizes using the norm.CS argument (see below). However, it is preferable to avoid altogether combining subsets that differ substantially in their landmark density if at all possible (Collyer et al., 2020). 
</div>

<div class = "func">
<details>
  <summary> <font size="+2"> `combine.subsets() (Expand for more details)` </font> </summary> 

* $...$: Landmark coordinates, Procrustes shape variables, or [gpagen]() objects. 
* $gpa$: Logical argument indicating if either a GPA should be performed, or if gpagen objects are provided. If TRUE, the function will perform a GPA, assuming that the inputs are sets of original un-aligned landmarks.
* $CS.sets$: A list, array, or matrix of centroid sizes to use for scaling. Should be left NULL unless gpa = FALSE.
* $norm.CS$: Optional logical argument to normalize centroid size, whereby centroid sizes (either input or generated by GPA) are divided by the square root of the number of landmarks.
8 $weights$: Optional argument to define weights used in calculation of centroid sizes (See Collyer et al., 2020). If not NULL, this option will override norm.CS.
  
</details>
</div>
<br></br>

<div class = "code">
```{r, comb}

```
</div>
<br></br>

There are several objects included in the output of `combine.subsets`:

* $cords$: This is an array of the combined and scaled landmark coordinates.
* $CS$: A matrix of columns of centroid sizes.
* $GPA$: If gpa = TRUE, the gpagen results for each subset.
* $gpa.coords.by.set$: Coordinates following gpa for each subset separately.
* $adj.coords.by.set$: Coordinates of each subset separately after rescaling.
* $points.by.set$: Vector of the number of landmarks in each subset.
<br></br>

<div class = "note">
#### **Important Note!** 
Make sure that the specimens in your subsets are the same specimens and that they are in the same order! Otherwise, the coordinates will not be concatenated properly.
</div>
<br></br>
